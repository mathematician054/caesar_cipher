<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Caesar Cipher</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
    }
    .buttons {
      display: flex;
      gap: 4%;
      margin-top: 5px;
    }
    .buttons button {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }
    .toggle-btn {
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
      width: 100%;
    }
    .output {
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .step-line {
      background: #fff;
      padding: 8px;
      border: 1px solid #ccc;
      margin-bottom: 4px;
      font-family: monospace;
    }
    #langkah-container {
      display: none;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>üîê Simulasi Caesar Cipher</h1>

  <label for="text">Teks:</label>
  <textarea id="text" rows="4">Halo Dunia!</textarea>

  <label for="key">Kunci Pergeseran (0-25):</label>
  <input type="number" id="key" value="3" min="0" max="25" />

  <div class="buttons">
    <button onclick="prosesCaesar(true)">üîê Enkripsi</button>
    <button onclick="prosesCaesar(false)">üîì Dekripsi</button>
  </div>

  <button class="toggle-btn" id="toggleButton" onclick="toggleLangkah()">üîç Tampilkan Visualisasi</button>

  <h3>Hasil:</h3>
  <div class="output" id="hasil"></div>

  <div id="langkah-container">
    <h3>Visualisasi:</h3>
    <div id="langkah"></div>
  </div>

  <script>
    function isLetter(c) {
      return /^[a-zA-Z]$/.test(c);
    }

    function prosesCaesar(encrypt = true) {
      const text = document.getElementById("text").value;
      const k = parseInt(document.getElementById("key").value) % 26;
      const hasilDiv = document.getElementById("hasil");
      const langkahDiv = document.getElementById("langkah");

      hasilDiv.textContent = "";
      langkahDiv.innerHTML = "";

      let hasil = "";

      for (let i = 0; i < text.length; i++) {
        const char = text[i];

        if (!isLetter(char)) {
          hasil += char;
          langkahDiv.innerHTML += `<div class="step-line">${char} (non-huruf) ‚Üí ${char}</div>`;
          continue;
        }

        const isUpper = char === char.toUpperCase();
        const base = isUpper ? 65 : 97;
        const indexText = char.charCodeAt(0) - base;

        let hasilIndex, rumus, substitusi;
        if (encrypt) {
          hasilIndex = (indexText + k) % 26;
          rumus = `E(x) = (x + k) mod 26`;
          substitusi = `E(${indexText}) = (${indexText} + ${k}) mod 26 = ${hasilIndex}`;
        } else {
          hasilIndex = (indexText - k + 26) % 26;
          rumus = `D(x) = (x - k + 26) mod 26`;
          substitusi = `D(${indexText}) = (${indexText} - ${k} + 26) mod 26 = ${hasilIndex}`;
        }

        const newChar = String.fromCharCode(base + hasilIndex);
        const stepText = `${char} ‚Üí ${indexText}; ${rumus}; ${substitusi} ‚Üí ${newChar}`;

        hasil += newChar;
        langkahDiv.innerHTML += `<div class="step-line">${stepText}</div>`;
      }

      hasilDiv.textContent = hasil;
      document.getElementById("langkah-container").style.display = "none";
      document.getElementById("toggleButton").textContent = "üîç Tampilkan Visualisasi";
    }

    function toggleLangkah() {
      const container = document.getElementById("langkah-container");
      const toggleBtn = document.getElementById("toggleButton");

      const isHidden = container.style.display === "none";
      container.style.display = isHidden ? "block" : "none";
      toggleBtn.textContent = isHidden ? "‚ùå Sembunyikan Visualisasi" : "üîç Tampilkan Visualisasi";
    }
  </script>
</body>
</html>
